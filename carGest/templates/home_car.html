<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestão de Dinheiro</title>
  <!-- Link para o arquivo CSS do Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link
    rel=
"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"
    type="text/css"
  />
  <script src=
"https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script
    src=
"https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"
    type="text/javascript"
  ></script>
  <script src=
"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  
  <script src=
"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.2/Chart.min.js"></script>
  <style>
    /* Adicione estilos personalizados aqui, se necessário */
    body {
      background-color: #f0f0f0;
    }
    .navbar-nav .nav-link {
      color:white; /* Substitua #ff0000 pela cor que desejar */
    }
 
  </style>
</head>

<body>
  <header>
    <!-- Barra de navegação do Bootstrap -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand" href="/">MoneyGest</a>
        <!-- Botão de menu responsivo -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <div class="d-flex align-items-center">
                <div id="navOptions" style="display:none;">
                    <ul class="navbar-nav ms-auto">
                      <li class="nav-item">
                        <a class="nav-link" href="#">Início</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#">Transações</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#">Orçamento</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#">Relatórios</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#">Car Gest</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="/carGest">Configurações</a>
                      </li><li class="nav-item">
                        <a class="nav-link" href="#">Sair</a>
                      </li>
                    </ul>
                  </div>
              <label id="usernameLabel" class="text-light me-2">Nome do Utilizador</label>
              <button id="toggleNavButton" class="btn btn-primary"><i class="fas fa-bars"></i></i></button>
            </div>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <main class="container mt-4"> 
    <div class="row">
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Metricas do carro</h5>
            <p class="card-text">Aqui você pode visualizar as metricas do seu carro.</p>
            <button class="btn btn-primary" id="btnVerBalanço"> Ver Balanço</button>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Historico abastecimentos</h5>
            <p class="card-text">Veja suas transações mais recentes e mantenha o controle do seu dinheiro.</p>
            <button class="btn btn-primary" id="btnVerTransacao">Ver Transações</button>
          </div>
        </div>
      </div>
    </div>




    <div class="modal fade" id="modalBalanco" tabindex="-1" role="dialog" aria-labelledby="modalBalancoLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalBalancoLabel">Balanço Financeiro</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <!-- Tabela para o balanço financeiro -->
          <table class="table">
            <thead>
              <tr>
                <th>Data</th>
                <th>Descrição</th>
                <th>Valor</th>
              </tr>
            </thead>
            <tbody>
              <!-- Preencha aqui os dados da tabela para o balanço financeiro -->
              <tr>
                <td>2023-07-31</td>
                <td>Recebimento do Salário</td>
                <td>R$ 3000,00</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para as transações -->
  <div class="modal fade" id="modalTransacoes" tabindex="-1" role="dialog" aria-labelledby="modalTransacoesLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTransacoesLabel">Transações Recentes</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <!-- Tabela para as transações -->
          <canvas id="meuGrafico"></canvas>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>



  <div class="modal fade" id="modalAddCarro" tabindex="-1" role="dialog" aria-labelledby="modalTransacoesLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTransacoesLabel">Adicionar Carro</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <form>
                <div class="mb-3">
                    <label for="kmAtuais" class="form-label">Marca/Modelo</label>
                    <input type="text" class="form-control" id="marca_modelo" required>
                </div>
              <div class="mb-3">
                  <label for="kmAtuais" class="form-label">Marticula</label>
                  <input type="text" class="form-control" id="matricula" required>
              </div>
                    <div class="mb-3">
                        <label for="kmAtuais" class="form-label">KM Atuais</label>
                        <input type="text" class="form-control" id="kmAtuais" required>
                    </div>
                    <div class="mb-3">
                      <label for="tipoCombustivel" class="form-label">Tipo Combustível</label>
                      <input type="text" class="form-control" id="tipoCombustivel" required>
                      <!-- Add dropdown, com opções do combustivel -->
                  </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                <button type="button" id="btnAddCarro" class="btn btn-primary">Salvar</button>
            </div>
        </div>
    </div>
</div>


  <div class="modal fade" id="modalAddAbastecimento" tabindex="-1" role="dialog" aria-labelledby="modalTransacoesLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTransacoesLabel">Adicionar Abastecimento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="kmAtuais" class="form-label">KM Atuais</label>
                        <input type="text" class="form-control" id="kmAtuais" required>
                    </div>
                    <div class="mb-3">
                        <label for="precoCombustivel" class="form-label">Preço Combustível/L</label>
                        <input type="text" class="form-control" id="precoCombustivel" required>
                    </div>
                  <div class="mb-3">
                    <label for="tipoCombustivel" class="form-label">Litros</label>
                    <input type="text" class="form-control" id="litros" required>
                </div>
                <div class="mb-3">
                  <label for="tipoCombustivel" class="form-label">Carro</label>
                  <input type="text" class="form-control" placeholder="Selecione o seu carro" id="carro" required>

                  <ul id="dropdown" style="display: none;">
                    <!-- Já não está aqui a fazer nada pois as opções estão a ser injetadas no js -->
                    <li>Opção 2</li>
                    <li>Opção 3</li>
                </ul>

              </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                <button type="button" id="btnAddAbastecimento"class="btn btn-primary">Salvar</button>
            </div>
        </div>
    </div>
</div>

  </main>

  
  <button class="btn btn-primary" id="btnAbreAddAbastecimento">Adicionar abastecimento</button>
  <button class="btn btn-primary" id="btnAbreAddCarro">Adicionar Carro</button>
  <!-- Link para o arquivo JavaScript do Bootstrap (opcional, mas alguns recursos do Bootstrap podem precisar disso) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<script>
    $(document).ready(function() {
      // CODIGO PARA ABASTECIMENTO

      const $inputBox = $('#carro');
      const $dropdown = $('#dropdown');

      function carregarOpcoes() {
        /* AJAX para ires buscar o json da view que vai dar os carros deste user */
        const opcoes = ["Carro 1", "Carro 2", "Carro   3"];
        $dropdown.empty(); // Limpa as opções anteriores

        // Cria elementos li para cada opção e adiciona ao dropdown
        opcoes.forEach(function(opcao) {
            const $li = $('<li>').text(opcao);
            $dropdown.append($li);
        });
      }

      // Mostrar o dropdown quando a caixa de entrada de texto é clicada
      $inputBox.on('click', function() {
          carregarOpcoes(); // Carrega as opções antes de exibir o dropdown
          $dropdown.show();
      });

      // Atualizar o valor da caixa de entrada de texto com a opção selecionada
      $dropdown.on('click', 'li', function() {
          $inputBox.val($(this).text());
          $dropdown.hide();
      });


      $('#btnAbreAddAbastecimento').on('click', function() {
            var modalBalanco = new bootstrap.Modal(document.getElementById('modalAddAbastecimento'));
            modalBalanco.show();
        });

        $(document).on("click", "#btnAddAbastecimento", function () {
          var id_carro = $("#carro").val();
          var km_atuais_carro = $("#kmAtuais").val();
          var litros =  $("#litros").val();
          var preco_combustivel =  $("#precoCombustivel").val();
          var valor_pago =  $("#precoCombustivel").val() * $("#litros").val();
          console.log("FOI CLICADO NO btnAddAbastecimento",id_carro,km_atuais_carro,litros,preco_combustivel,valor_pago);

        $.ajax({
          type: "GET",
          url: "/carGest/addAbastecimento/",
          data: {
            csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
            id_carro : id_carro,
            km_atuais_carro : km_atuais_carro,
            litros: litros,
            preco_combustivel: preco_combustivel,
            valor_pago: valor_pago,
            carro: carro,
        },
          success: function () {
           alert("ABASTECIMENTO ADICIONADO")
          }});

        });
      
        $('#btnAbreAddCarro').on('click', function() {
            var modaAddCarro = new bootstrap.Modal(document.getElementById('modalAddCarro'));
            modaAddCarro.show();
        });

// CODIGO PARA CARRO

        $(document).on("click", "#btnAddCarro", function () {
          var marca_modelo = $("#marca_modelo").val();
          var matricula = $("#matricula").val();
          var kmAtuais =  $("#kmAtuais").val();
          var tipoCombustivel =  $("#tipoCombustivel").val();

        $.ajax({
          type: "GET",
          url: "/carGest/addCarro/",
          data: {
            csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
            marca_modelo : marca_modelo,
            matricula : matricula,
            kmAtuais: kmAtuais,
            tipoCombustivel: tipoCombustivel,
        },
          success: function () {
           alert("CARRO ADICIONADO")
          }});
          
        });


        $('#btnVerBalanço').on('click', function() {
            var modalBalanco = new bootstrap.Modal(document.getElementById('modalBalanco'));
            modalBalanco.show();
        });

        // codigo para clique do botao que vai abrir popup do historico de abastecimentos
        $('#btnVerTransacao').on('click', function() {
            var modalTransacoes = new bootstrap.Modal(document.getElementById('modalTransacoes'));
            var ctx = document.getElementById("meuGrafico").getContext("2d");
            // Ajax onde vais buscar os dados do grafico quando abres o poupup inicialmente (Media ultimos 6 meses)
            // Defina os dados do gráfico (substitua isso pelos seus próprios dados)
            var data = {
                labels: ["Janeiro", "Fevereiro", "Março", "Abril", "Maio"],
                datasets: [{
                    label: "Vendas",
                    data: [50, 60, 70, 65, 80],
                    backgroundColor: "rgba(27, 113, 247, 0.2)",
                    borderColor: "rgba(27, 114, 249, 0.2)",
                    borderWidth: 1
                }]
            };

            // Defina as opções do gráfico (personalize conforme necessário)
            var options = {
                responsive: true,
                maintainAspectRatio: false
            };

            // Crie o gráfico
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: data,
                options: options
            });
            modalTransacoes.show();
        });

    // Função para alternar a visibilidade das opções de navegação
    function toggleNavigation() {
      var navOptions = document.getElementById("navOptions");
      var usernameLabel = document.getElementById("usernameLabel");
      var toggleNavButton = document.getElementById("toggleNavButton");

      if (navOptions.style.display === "none") {
        navOptions.style.display = "block";
        usernameLabel.style.display = "none";
        toggleNavButton.innerHTML = `<i class="fas fa-bars"></i>`;
      } else {
        navOptions.style.display = "none";
        usernameLabel.style.display = "inline";
        toggleNavButton.innerHTML = `<i class="fas fa-bars"></i>`;

      }
    }
    // Adiciona o evento de clique no botão para chamar a função de alternar
    document.getElementById("toggleNavButton").addEventListener("click", toggleNavigation);

    
})
  </script>
</body>

</html>
